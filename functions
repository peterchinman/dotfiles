# Git worktree add with sibling directory convention: repo--branch
gwt() {
  if [ -z "$1" ]; then
    echo "Usage: gwt <branch> [start-point]    (creates new branch)"
    echo "       gwt -e <existing-branch>      (checkout existing branch)"
    return 1
  fi

  local root=$(git rev-parse --show-toplevel 2>/dev/null)
  if [ -z "$root" ]; then
    echo "Not in a git repository"
    return 1
  fi

  local repo=$(basename "$root")
  local parent=$(dirname "$root")

  if [ "$1" = "-e" ]; then
    local branch="$2"
    local path="$parent/$repo--$branch"
    git worktree add "$path" "$branch" && cd "$path"
  else
    local branch="$1"
    local start_point="${2:-HEAD}"
    local path="$parent/$repo--$branch"
    git worktree add -b "$branch" "$path" "$start_point" && cd "$path"
  fi
}

# Git worktree switch with fzf
gws() {
  local worktree=$(git worktree list | fzf --height=10 | awk '{print $1}')
  [ -n "$worktree" ] && cd "$worktree"
}
